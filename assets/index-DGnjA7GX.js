(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();const s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"75ad4f03-c299-4ec1-9dff-67bbf5b23629","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),V=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(p),D=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(p),j=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(p),J=({avatar:e})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(p),H=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(p),z=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(p),K=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(r=>p(r)),R=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,{onPreviewPicture:t,onLikeIcon:r,onDeleteCard:n})=>{const o=R(),c=o.querySelector(".card__like-button"),l=o.querySelector(".card__control-button_type_delete"),i=o.querySelector(".card__image");return i.src=e.link,i.alt=e.name,o.querySelector(".card__title").textContent=e.name,r&&c.addEventListener("click",()=>r(c)),n&&l.addEventListener("click",()=>n(o)),t&&i.addEventListener("click",()=>t({name:e.name,link:e.link})),o},U=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",U)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",U)},G=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",r=>{r.target.classList.contains("popup")&&a(e)})},Q=(e,t,r,n,o)=>{const c=e.querySelector(`#${t.id}-error`);t.classList.add(r),c.textContent=n,c.classList.add(o)},w=(e,t,r,n)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r),o.textContent="",o.classList.remove(n)},X=(e,t,r,n)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?w(e,t,r,n):Q(e,t,r,t.validationMessage,n)},Y=e=>e.some(t=>!t.validity.valid),b=(e,t)=>{e.classList.add(t),e.setAttribute("disabled",!0)},Z=(e,t)=>{e.classList.remove(t),e.removeAttribute("disabled")},f=(e,t,r)=>{Y(e)?b(t,r):Z(t,r)},ee=(e,t,r,n,o,c)=>{const l=Array.from(e.querySelectorAll(t));f(l,o,c),l.forEach(i=>{i.addEventListener("input",()=>{X(e,i,r,n),f(l,o,c)})})},te=e=>{const{formSelector:t,inputSelector:r,submitButtonSelector:n,inactiveButtonClass:o,inputErrorClass:c,errorClass:l}=e;Array.from(document.querySelectorAll(t)).forEach(d=>{const y=d.querySelector(n),W=Array.from(d.querySelectorAll(r));f(W,y,o),ee(d,r,c,l,y,o)})},g=(e,t)=>{const{inputSelector:r,submitButtonSelector:n,inactiveButtonClass:o,inputErrorClass:c,errorClass:l}=t,i=document.querySelector(n),d=Array.from(e.querySelectorAll(r));b(i,o),d.forEach(y=>{w(e,y,c,l),b(i,o)}),f(d,i,o)},F=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),_=L.querySelector(".popup__form"),B=_.querySelector(".popup__input_type_name"),M=_.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),u=C.querySelector(".popup__form"),oe=u.querySelector(".popup__input_type_card-name"),re=u.querySelector(".popup__input_type_url"),q=document.querySelector(".popup_type_remove-card"),v=q.querySelector(".popup__form");document.querySelector(".popup_type_info");document.querySelector(".popup__content_content_info");document.querySelector("#popup-info-definition-template");document.querySelector("#popup-info-user-preview-template");const k=document.querySelector(".popup_type_image"),A=k.querySelector(".popup__image"),ne=k.querySelector(".popup__caption"),ce=document.querySelector(".profile__edit-button"),se=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_edit-avatar"),h=P.querySelector(".popup__form"),le=h.querySelector(".popup__input"),S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};te(S);const O=({name:e,link:t})=>{A.src=t,A.alt=e,ne.textContent=e,m(k)},T=(e,t)=>{m(q),v.addEventListener("submit",r=>{r.preventDefault(),v.querySelector(".popup__button").textContent="Удаление...",z(t).then(n=>{console.log(n.message),e.remove(),a(q)}).catch(n=>{console.log(`Ошибка при удалении карточки: ${n}`)}).finally(()=>{v.querySelector(".popup__button").textContent="Да"})})},N=(e,t)=>{const r=e.classList.contains("card__like-button_is-active");K(t,r).then(n=>{e.parentElement.querySelector(".card__like-count").textContent=n.likes.length||"",e.classList.toggle("card__like-button_is-active")}).catch(n=>{console.log(`Ошибка при ${r?"снятии":"постановке"} лайка: ${n}`)})},ie=e=>{e.preventDefault(),_.querySelector(".popup__button").textContent="Сохранение...",j({name:B.value,about:M.value}).then(t=>{E.textContent=t.name,x.textContent=t.about,a(L)}).catch(t=>{console.log(t)}).finally(()=>{_.querySelector(".popup__button").textContent="Сохранить"})},ae=e=>{e.preventDefault(),J({avatar:le.value}).then(t=>{I.style.backgroundImage=`url(${t.avatar})`,a(P)}).catch(t=>{console.log(t)})},ue=e=>{e.preventDefault(),u.querySelector(".popup__button").textContent="Создание...",H({name:oe.value,link:re.value}).then(t=>{F.prepend($({name:t.name,link:t.link},{onPreviewPicture:O,onLikeIcon:r=>N(r,t._id),onDeleteCard:r=>T(r,t._id)})),a(C)}).catch(t=>{console.log(t)}).finally(()=>{u.querySelector(".popup__button").textContent="Создать"})};_.addEventListener("submit",ie);u.addEventListener("submit",ue);h.addEventListener("submit",ae);ce.addEventListener("click",()=>{B.value=E.textContent,M.value=x.textContent,m(L),g(_,S)});I.addEventListener("click",()=>{h.reset(),m(P),g(h,S)});se.addEventListener("click",()=>{u.reset(),m(C),g(u,S)});const pe=document.querySelectorAll(".popup");pe.forEach(e=>{G(e)});Promise.all([D(),V()]).then(([e,t])=>{e.forEach(r=>{const n=$(r,{onPreviewPicture:O,onLikeIcon:o=>N(o,r._id),onDeleteCard:r.owner._id===t._id?o=>T(o,r._id):""});r.likes.flat().find(o=>o._id===t._id)&&n.querySelector(".card__like-button").classList.add("card__like-button_is-active"),n.querySelector(".card__like-count").textContent=r.likes.length||"",F.append(n),r.owner._id===t._id||n.querySelector(".card__control-button_type_delete").remove()}),E.textContent=t.name,x.textContent=t.about,I.style.backgroundImage=`url(${t.avatar})`}).catch(e=>{console.log(e)});
