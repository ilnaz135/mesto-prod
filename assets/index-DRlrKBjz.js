(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const i={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"75ad4f03-c299-4ec1-9dff-67bbf5b23629","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),j=()=>fetch(`${i.baseUrl}/users/me`,{headers:i.headers}).then(d),M=()=>fetch(`${i.baseUrl}/cards`,{headers:i.headers}).then(d),J=({name:e,about:t})=>fetch(`${i.baseUrl}/users/me`,{method:"PATCH",headers:i.headers,body:JSON.stringify({name:e,about:t})}).then(d),R=({avatar:e})=>fetch(`${i.baseUrl}/users/me`,{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:e})}).then(d),z=({name:e,link:t})=>fetch(`${i.baseUrl}/cards`,{method:"POST",headers:i.headers,body:JSON.stringify({name:e,link:t})}).then(d),K=e=>fetch(`${i.baseUrl}/cards/${e}`,{method:"DELETE",headers:i.headers}).then(d),G=(e,t)=>fetch(`${i.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:i.headers}).then(o=>d(o)),Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),T=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:c,onCheckInfoCard:r})=>{const n=Q(),s=n.querySelector(".card__like-button"),l=n.querySelector(".card__control-button_type_delete"),a=n.querySelector(".card__image"),y=n.querySelector(".card__control-button_type_info");return a.src=e.link,a.alt=e.name,n.querySelector(".card__title").textContent=e.name,o&&s.addEventListener("click",()=>o(s)),c&&l.addEventListener("click",()=>c(n)),t&&a.addEventListener("click",()=>t({name:e.name,link:e.link})),r&&y.addEventListener("click",()=>r(e._id)),n},B=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",B)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",B)},X=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&p(e)})},Y=(e,t,o,c,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(o),n.textContent=c,n.classList.add(r)},F=(e,t,o,c)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o),r.textContent="",r.classList.remove(c)},Z=(e,t,o,c)=>{if(t.validity.patternMismatch?t.setCustomValidity(t.validity.tooShort?`Поле должно содержать от ${t.getAttribute("minlength")} до ${t.getAttribute("maxlength")} символов.`:t.dataset.errorMessage):t.setCustomValidity(""),!t.validity.valid){Y(e,t,o,t.validationMessage,c);return}F(e,t,o,c)},ee=e=>e.some(t=>!t.validity.valid),h=(e,t)=>{e.classList.add(t),e.setAttribute("disabled",!0)},te=(e,t)=>{e.classList.remove(t),e.removeAttribute("disabled")},g=(e,t,o)=>{ee(e)?h(t,o):te(t,o)},oe=(e,t,o,c,r,n)=>{const s=Array.from(e.querySelectorAll(t));g(s,r,n),s.forEach(l=>{l.addEventListener("input",()=>{Z(e,l,o,c),g(s,r,n)})})},re=e=>{const{formSelector:t,inputSelector:o,submitButtonSelector:c,inactiveButtonClass:r,inputErrorClass:n,errorClass:s}=e;Array.from(document.querySelectorAll(t)).forEach(a=>{const y=Array.from(a.querySelectorAll(o)),U=a.querySelector(c);g(y,U,r),oe(a,o,n,s,U,r)})},L=(e,t)=>{const{inputSelector:o,submitButtonSelector:c,inactiveButtonClass:r,inputErrorClass:n,errorClass:s}=t,l=e.querySelector(c),a=Array.from(e.querySelectorAll(o));h(l,r),a.forEach(y=>{F(e,y,n,s),h(l,r)}),h(l,r)},N=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),_=k.querySelector(".popup__form"),O=_.querySelector(".popup__input_type_name"),D=_.querySelector(".popup__input_type_description"),x=document.querySelector(".popup_type_new-card"),u=x.querySelector(".popup__form"),ne=u.querySelector(".popup__input_type_card-name"),ce=u.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_remove-card"),b=C.querySelector(".popup__form"),se=document.querySelector(".popup_type_info"),f=document.querySelector(".popup__content_content_info"),ie=document.querySelector("#popup-info-definition-template"),le=document.querySelector("#popup-info-user-preview-template"),I=document.querySelector(".popup_type_image"),w=I.querySelector(".popup__image"),ae=I.querySelector(".popup__caption"),ue=document.querySelector(".profile__edit-button"),pe=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),$=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_edit-avatar"),v=P.querySelector(".popup__form"),de=v.querySelector(".popup__input"),q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};re(q);const _e=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),W=({name:e,link:t})=>{w.src=t,w.alt=e,ae.textContent=e,m(I)},S=(e,t)=>{const o=ie.content.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},me=e=>{const t=le.content.querySelector(".popup__list-item").cloneNode(!0);return t.textContent=e.name,t},ye=e=>{M().then(t=>{const o=t.find(l=>l._id===e),c=f.querySelector(".popup__title"),r=f.querySelector(".popup__text"),n=f.querySelector(".popup__info"),s=f.querySelector(".popup__list");c.textContent="Информация о карточке",r.textContent="Лайкнули",n.innerHTML="",s.innerHTML="",n.append(S("Описание: ",o.name)),n.append(S("Дата создания:",_e(new Date(o.createdAt)))),n.append(S("Владелец:",o.owner.name)),n.append(S("Количество лайков:",o.likes.length)),o.likes.length>0?o.likes.forEach(l=>{s.append(me(l))}):s.append("Пока никто не лайкнул"),m(se)}).catch(t=>{console.log(t)})},V=(e,t)=>{m(C),b.addEventListener("submit",o=>{o.preventDefault(),b.querySelector(".popup__button").textContent="Удаление...",K(t).then(c=>{console.log(c.message),e.remove(),p(C)}).catch(c=>{console.log(`Ошибка при удалении карточки: ${c}`)}).finally(()=>{b.querySelector(".popup__button").textContent="Да"})})},H=(e,t)=>{const o=e.classList.contains("card__like-button_is-active");G(t,o).then(c=>{e.parentElement.querySelector(".card__like-count").textContent=c.likes.length||"",e.classList.toggle("card__like-button_is-active")}).catch(c=>{console.log(`Ошибка при ${o?"снятии":"постановке"} лайка: ${c}`)})},fe=e=>{e.preventDefault(),_.querySelector(".popup__button").textContent="Сохранение...",J({name:O.value,about:D.value}).then(t=>{E.textContent=t.name,A.textContent=t.about,p(k)}).catch(t=>{console.log(t)}).finally(()=>{_.querySelector(".popup__button").textContent="Сохранить"})},Se=e=>{e.preventDefault(),u.querySelector(".popup__button").textContent="Сохранение...",R({avatar:de.value}).then(t=>{$.style.backgroundImage=`url(${t.avatar})`,p(P)}).catch(t=>{console.log(t)}).finally(()=>{u.querySelector(".popup__button").textContent="Сохранить"})},he=e=>{e.preventDefault(),u.querySelector(".popup__button").textContent="Создание...",z({name:ne.value,link:ce.value}).then(t=>{N.prepend(T({name:t.name,link:t.link},{onPreviewPicture:W,onLikeIcon:o=>H(o,t._id),onDeleteCard:o=>V(o,t._id)})),p(x)}).catch(t=>{console.log(t)}).finally(()=>{u.querySelector(".popup__button").textContent="Создать"})};_.addEventListener("submit",fe);u.addEventListener("submit",he);v.addEventListener("submit",Se);ue.addEventListener("click",()=>{O.value=E.textContent,D.value=A.textContent,m(k),L(_,q)});$.addEventListener("click",()=>{v.reset(),m(P),L(v,q)});pe.addEventListener("click",()=>{u.reset(),m(x),L(u,q)});const ve=document.querySelectorAll(".popup");ve.forEach(e=>{X(e)});Promise.all([M(),j()]).then(([e,t])=>{e.forEach(o=>{const c=T(o,{onPreviewPicture:W,onLikeIcon:r=>H(r,o._id),onDeleteCard:o.owner._id===t._id?r=>V(r,o._id):"",onCheckInfoCard:ye});o.likes.flat().find(r=>r._id===t._id)&&c.querySelector(".card__like-button").classList.add("card__like-button_is-active"),c.querySelector(".card__like-count").textContent=o.likes.length||"",N.append(c),o.owner._id===t._id||c.querySelector(".card__control-button_type_delete").remove()}),E.textContent=t.name,A.textContent=t.about,$.style.backgroundImage=`url(${t.avatar})`}).catch(e=>{console.log(e)});
