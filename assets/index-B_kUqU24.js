(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();const s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"75ad4f03-c299-4ec1-9dff-67bbf5b23629","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),V=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(p),D=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(p),j=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(p),J=({avatar:e})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(p),H=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(p),z=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(p),K=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(r=>p(r)),R=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),U=(e,{onPreviewPicture:t,onLikeIcon:r,onDeleteCard:n})=>{const o=R(),c=o.querySelector(".card__like-button"),i=o.querySelector(".card__control-button_type_delete"),l=o.querySelector(".card__image");return l.src=e.link,l.alt=e.name,o.querySelector(".card__title").textContent=e.name,r&&c.addEventListener("click",()=>r(c)),n&&i.addEventListener("click",()=>n(o)),t&&l.addEventListener("click",()=>t({name:e.name,link:e.link})),o},w=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",w)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",w)},G=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",r=>{r.target.classList.contains("popup")&&a(e)})},Q=(e,t,r,n,o)=>{const c=e.querySelector(`#${t.id}-error`);t.classList.add(r),c.textContent=n,c.classList.add(o)},F=(e,t,r,n)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r),o.textContent="",o.classList.remove(n)},X=(e,t,r,n)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?F(e,t,r,n):Q(e,t,r,t.validationMessage,n)},Y=e=>e.some(t=>!t.validity.valid),y=(e,t)=>{e.classList.add(t),e.setAttribute("disabled",!0)},Z=(e,t)=>{e.classList.remove(t),e.removeAttribute("disabled")},b=(e,t,r)=>{Y(e)?y(t,r):Z(t,r)},ee=(e,t,r,n,o,c)=>{const i=Array.from(e.querySelectorAll(t));b(i,o,c),i.forEach(l=>{l.addEventListener("input",()=>{X(e,l,r,n),b(i,o,c)})})},te=e=>{const{formSelector:t,inputSelector:r,submitButtonSelector:n,inactiveButtonClass:o,inputErrorClass:c,errorClass:i}=e;Array.from(document.querySelectorAll(t)).forEach(_=>{const S=Array.from(_.querySelectorAll(r)),A=_.querySelector(n);b(S,A,o),ee(_,r,c,i,A,o)})},g=(e,t)=>{const{inputSelector:r,submitButtonSelector:n,inactiveButtonClass:o,inputErrorClass:c,errorClass:i}=t,l=e.querySelector(n),_=Array.from(e.querySelectorAll(r));y(l,o),_.forEach(S=>{F(e,S,c,i),y(l,o)}),y(l,o)},B=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),d=L.querySelector(".popup__form"),M=d.querySelector(".popup__input_type_name"),O=d.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),u=C.querySelector(".popup__form"),oe=u.querySelector(".popup__input_type_card-name"),re=u.querySelector(".popup__input_type_url"),q=document.querySelector(".popup_type_remove-card"),v=q.querySelector(".popup__form");document.querySelector(".popup_type_info");document.querySelector(".popup__content_content_info");document.querySelector("#popup-info-definition-template");document.querySelector("#popup-info-user-preview-template");const k=document.querySelector(".popup_type_image"),$=k.querySelector(".popup__image"),ne=k.querySelector(".popup__caption"),ce=document.querySelector(".profile__edit-button"),se=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_edit-avatar"),f=P.querySelector(".popup__form"),ie=f.querySelector(".popup__input"),h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};te(h);const T=({name:e,link:t})=>{$.src=t,$.alt=e,ne.textContent=e,m(k)},N=(e,t)=>{m(q),v.addEventListener("submit",r=>{r.preventDefault(),v.querySelector(".popup__button").textContent="Удаление...",z(t).then(n=>{console.log(n.message),e.remove(),a(q)}).catch(n=>{console.log(`Ошибка при удалении карточки: ${n}`)}).finally(()=>{v.querySelector(".popup__button").textContent="Да"})})},W=(e,t)=>{const r=e.classList.contains("card__like-button_is-active");K(t,r).then(n=>{e.parentElement.querySelector(".card__like-count").textContent=n.likes.length||"",e.classList.toggle("card__like-button_is-active")}).catch(n=>{console.log(`Ошибка при ${r?"снятии":"постановке"} лайка: ${n}`)})},le=e=>{e.preventDefault(),d.querySelector(".popup__button").textContent="Сохранение...",j({name:M.value,about:O.value}).then(t=>{E.textContent=t.name,x.textContent=t.about,a(L)}).catch(t=>{console.log(t)}).finally(()=>{d.querySelector(".popup__button").textContent="Сохранить"})},ae=e=>{e.preventDefault(),J({avatar:ie.value}).then(t=>{I.style.backgroundImage=`url(${t.avatar})`,a(P)}).catch(t=>{console.log(t)})},ue=e=>{e.preventDefault(),u.querySelector(".popup__button").textContent="Создание...",H({name:oe.value,link:re.value}).then(t=>{B.prepend(U({name:t.name,link:t.link},{onPreviewPicture:T,onLikeIcon:r=>W(r,t._id),onDeleteCard:r=>N(r,t._id)})),a(C)}).catch(t=>{console.log(t)}).finally(()=>{u.querySelector(".popup__button").textContent="Создать"})};d.addEventListener("submit",le);u.addEventListener("submit",ue);f.addEventListener("submit",ae);ce.addEventListener("click",()=>{M.value=E.textContent,O.value=x.textContent,m(L),g(d,h)});I.addEventListener("click",()=>{f.reset(),m(P),g(f,h)});se.addEventListener("click",()=>{u.reset(),m(C),g(u,h)});const pe=document.querySelectorAll(".popup");pe.forEach(e=>{G(e)});Promise.all([D(),V()]).then(([e,t])=>{e.forEach(r=>{const n=U(r,{onPreviewPicture:T,onLikeIcon:o=>W(o,r._id),onDeleteCard:r.owner._id===t._id?o=>N(o,r._id):""});r.likes.flat().find(o=>o._id===t._id)&&n.querySelector(".card__like-button").classList.add("card__like-button_is-active"),n.querySelector(".card__like-count").textContent=r.likes.length||"",B.append(n),r.owner._id===t._id||n.querySelector(".card__control-button_type_delete").remove()}),E.textContent=t.name,x.textContent=t.about,I.style.backgroundImage=`url(${t.avatar})`}).catch(e=>{console.log(e)});
